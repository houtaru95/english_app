<%= render "shared/header_speak" %>

<div class="speak_show_container">
  <h1>Showing Page</h1>
  <div>
    <div>
      subject:  <%= @speak.subject %>
    </div>
    <div>
      voice:  <%= @speak.voice %>
    </div> 
    <%= link_to user_path(@speak.user.id) do %>
      <p>by <%= @speak.user.nickname%></p>
    <% end %>
    <%= @speak.created_at.strftime("%b %d %H:%M") %>
    <div class="tag_box">
      <div class="tag_list">
        <% @speak.tag_list.each do |tag| %>
        <div>
          <span style="background-color: #e9e9e9; border-radius: 5px;"><%= tag %></span>
        </div>
        <% end %>
      </div> 
    </div>
    <% if current_user.id == @speak.user.id %>
      <div class="edit_speak">
        <%= link_to edit_speak_path(@speak.id), class: "edit-speak" do %>
          <i class="far fa-edit"></i>
        <% end %>
      </div>
      <div class="destroy_speak">
        <%= link_to speak_path(@speak.id), method: :delete, class:"destroy-speak",data: {confirm: "Are you sure to delete?"} do %>
          <i class="fas fa-trash"></i>
        <% end %>
      </div>
    <% end %>

    <div class="comments">
      <h4>＜comments below＞</h4>
      <% @comments.each do |comment| %>
        <% if comment.response_comment.present? %>
          <% next %>
        <% end %>
        <p><%= link_to comment.user.nickname, user_path(comment.user_id) %>:<%= comment.text %></p>
        <% if Time.now.strftime("%Y %b %d") == comment.created_at.strftime("%Y %b %d") %>
          <p><%= comment.created_at.strftime("%H:%M")%>
        <% else %>
          <p><%= comment.created_at.strftime("%Y %b %d %H:%M")%>
        <% end %>
        <% if current_user.id == comment.user.id %>
          <div class="destroy_comment">
            <%= link_to speak_comment_path(comment.speak.id, comment.id), method: :delete, class:"destroy-comment",data: {confirm: "Are you sure to delete?"} do %>
              <i class="fas fa-trash"></i>
            <% end %>
          </div>
        <% end %>
        <div class="response_area">
          <% comment.responses.order(:created_at).each do |response| %>
            <p> <%= response.user.nickname %> : <%=response.text%></p>
            <% if Time.now.strftime("%Y %b %d") == comment.created_at.strftime("%Y %b %d") %>
              <p><%= comment.created_at.strftime("%H:%M")%>
            <% else %>
              <p><%= comment.created_at.strftime("%Y %b %d %H:%M")%>
            <% end %>
          <% end %>
        </div>
        <div class="response_box">
          <%= form_for [@speak, @response_comments] do |f| %>
            <%= f.hidden_field :response_comment, value: comment.id %>
            <%= f.text_field :text %>
            <%= f.submit "Reply"%>
          <% end %>
        </div>
      <% end %>
    </div>

    <div >
      <% if user_signed_in? %>
        <%= form_with(model: [@speak, @comment],method: :post, local: true) do |f| %> 
          <%= f.text_area :text, placeholder: "Response", rows: "3" %>
          <%= f.submit "Response" %>
        <% end %>
      <% end %> 
    </div>
  </div>
</div>

<%= link_to "back to TimeLine", speaks_path %>

<%= render "shared/footer_speak" %>
